##########################
# This file was generated by Claude.ai
# to help load the dummy user data
# into the Sqlite database
##########################




import sqlite3 from "sqlite3";
import bcrypt from 'bcryptjs';
import path from "path";
import { fileURLToPath } from "url";
import { DM_data } from "./Data/DM_data.js";
import { Player_data } from "./Data/Player_data.js";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const dbPath = path.join(__dirname, './users.db');
const db = new sqlite3.Database(dbPath);

// Default password for all dummy users
const DEFAULT_PASSWORD = "password123";

async function seedDatabase() {
    console.log("Starting database seed...");

    // Hash the default password once
    const hashedPassword = await bcrypt.hash(DEFAULT_PASSWORD, 10);

    // Insert DMs
    for (const dm of DM_data) {
        await new Promise((resolve, reject) => {
            db.run(
                `INSERT INTO users (username, password, role, location, schedule) VALUES (?, ?, ?, ?, ?)`,
                [dm.name, hashedPassword, 'DM', dm.location, dm.schedule],
                function(err) {
                    if (err) {
                        if (err.message.includes('UNIQUE constraint failed')) {
                            console.log(`DM ${dm.name} already exists, skipping...`);
                        } else {
                            console.error(`Error inserting DM ${dm.name}:`, err);
                        }
                    } else {
                        console.log(`✓ Inserted DM: ${dm.name}`);
                    }
                    resolve();
                }
            );
        });
    }

    // Insert Players
    for (const player of Player_data) {
        await new Promise((resolve, reject) => {
            db.run(
                `INSERT INTO users (username, password, role, location, schedule) VALUES (?, ?, ?, ?, ?)`,
                [player.name, hashedPassword, 'Player', player.location, player.schedule],
                function(err) {
                    if (err) {
                        if (err.message.includes('UNIQUE constraint failed')) {
                            console.log(`Player ${player.name} already exists, skipping...`);
                        } else {
                            console.error(`Error inserting Player ${player.name}:`, err);
                        }
                    } else {
                        console.log(`✓ Inserted Player: ${player.name}`);
                    }
                    resolve();
                }
            );
        });
    }

    console.log("\n✓ Database seeding complete!");
    console.log(`Default password for all users: ${DEFAULT_PASSWORD}`);
    
    db.close();
}

seedDatabase().catch(console.error);
